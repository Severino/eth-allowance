(this["webpackJsonpeth-allowance"]=this["webpackJsonpeth-allowance"]||[]).push([[0],{197:function(t,e){},206:function(t,e){},222:function(t,e){},224:function(t,e){},251:function(t,e){},272:function(t,e){},274:function(t,e){},283:function(t,e){},285:function(t,e){},310:function(t,e){},312:function(t,e){},313:function(t,e){},318:function(t,e){},320:function(t,e){},339:function(t,e){},351:function(t,e){},354:function(t,e){},359:function(t,e){},374:function(t,e){},377:function(t,e){},446:function(t,e,n){"use strict";n.r(e);var a=n(1),s=n(13),i=n.n(s),r=n(181),o=n.n(r),c=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,447)).then((function(e){var n=e.getCLS,a=e.getFID,s=e.getFCP,i=e.getLCP,r=e.getTTFB;n(t),a(t),s(t),i(t),r(t)}))},p=(n(187),n(90),n(55)),u=n.n(p),d=n(56),l=n(35),m=n(36),f=n(38),y=n(37),b=function(t){Object(f.a)(n,t);var e=Object(y.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,s=new Array(a),i=0;i<a;i++)s[i]=arguments[i];return(t=e.call.apply(e,[this].concat(s))).revokeAll=function(){var t,e=document.getElementsByName("revoke"),n=Object(d.a)(e);try{for(n.s();!(t=n.n()).done;){t.value.click()}}catch(a){n.e(a)}finally{n.f()}},t}return Object(m.a)(n,[{key:"render",value:function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)("div",{className:"jumbotron",children:Object(a.jsxs)("div",{id:"titles",children:[Object(a.jsx)("h1",{children:"ETH Allowance"}),Object(a.jsx)("h2",{children:"Find & revoke all the addresses that can spend your tokens"})]})}),Object(a.jsx)("div",{id:"gh",children:Object(a.jsx)("a",{href:"https://github.com/James-Sangalli/eth-allowance",target:"_blank",children:Object(a.jsx)("img",{alt:"GitHub",src:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Octicons-mark-github.svg/2048px-Octicons-mark-github.svg.png",width:"40",height:"40"})})}),Object(a.jsx)("h3",{id:"loading",hidden:!0,children:"Loading, please wait..."}),Object(a.jsxs)("div",{id:"results",children:[Object(a.jsxs)("div",{className:"grid-container",children:[Object(a.jsx)("div",{className:"grid-item",children:"Contract"}),Object(a.jsx)("div",{className:"grid-item",children:"Approved Address"}),Object(a.jsx)("div",{className:"grid-item",children:"Allowance"}),Object(a.jsx)("div",{className:"grid-item",children:"Action"})]}),Object(a.jsx)("div",{id:"revokeAll",hidden:!0,children:Object(a.jsxs)("div",{className:"grid-container",children:[Object(a.jsx)("div",{className:"grid-items",children:"ALL"}),Object(a.jsx)("div",{className:"grid-items",children:"ALL"}),Object(a.jsx)("div",{className:"grid-items",children:"ALL"}),Object(a.jsx)("div",{className:"grid-items",children:Object(a.jsx)("button",{className:"btn btn-danger",onClick:this.revokeAll,children:" Revoke All Allowances"})})]})})]})]})}}]),n}(s.Component),h=n(9),v=n.n(h),j=n(39),x=n(55),g=new x(x.givenProvider),w=n(439),O="0x095ea7b3",k="ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",_=n(88),I=_.ERC20ABI,N=_.ERC721ABI;function M(t,e){switch(t){case 1:return"https://api.etherscan.io/api?module=account&action=txlist&address="+e;case 3:return"https://ropsten.etherscan.io/api?module=account&action=txlist&address="+e;case 4:return"https://rinkeby.etherscan.io/api?module=account&action=txlist&address="+e;case 42:return"https://kovan.etherscan.io/api?module=account&action=txlist&address="+e;case 56:return"https://api.bscscan.com/api?module=account&action=txlist&address="+e;default:return""}}function A(t){return C.apply(this,arguments)}function C(){return(C=Object(j.a)(v.a.mark((function t(e){var n,a,s,i,r,o;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w.get(e);case 3:n=t.sent,a=[],s=JSON.parse(n.text).result,console.log("etherscan api return ",s),i=Object(d.a)(s);try{for(i.s();!(r=i.n()).done;)(o=r.value).input.includes(O)&&function(){console.log("found approve transaction");var t={};t.contract=g.utils.toChecksumAddress(o.to),t.approved=g.utils.toChecksumAddress("0x"+o.input.substring(34,74));var e=o.input.substring(74);e.includes(k)?t.allowance="unlimited":(t.allowance="some",t.allowanceUnEdited=e),0!==parseInt(e,16)?a.push(t):a=a.filter((function(e){return!(e.approved===t.approved&&e.contract===e.contract)}))}()}catch(c){i.e(c)}finally{i.f()}return t.abrupt("return",a);case 12:throw t.prev=12,t.t0=t.catch(0),t.t0;case 15:case"end":return t.stop()}}),t,null,[[0,12]])})))).apply(this,arguments)}function R(t){return E.apply(this,arguments)}function E(){return(E=Object(j.a)(v.a.mark((function t(e){var n;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=new g.eth.Contract(I,e),t.next=4,n.methods.name().call();case 4:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return",e);case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))).apply(this,arguments)}function B(){return(B=Object(j.a)(v.a.mark((function t(e,n){var a;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new g.eth.Contract(N,e),t.prev=1,t.next=4,a.methods.ownerOf(n).call();case 4:return t.sent,t.abrupt("return",!0);case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",!1);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}var L=n(46),S=n(89),U=n.n(S),T=n(88),J=function(t){Object(f.a)(n,t);var e=Object(y.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).props=t,a.setRevokeClick=a.setRevokeClick.bind(Object(L.a)(a)),a.dappURL=a.dappURL.bind(Object(L.a)(a)),a}return Object(m.a)(n,[{key:"dappURL",value:function(){for(var t="",e=0,n=Object.keys(U.a);e<n.length;e++){var a=n[e];this.props.tx.contractName.toLowerCase().includes(a)&&(t=U.a[a])}return t}},{key:"setRevokeClick",value:function(){var t=this,e=new this.props.web3.eth.Contract(T.ERC20ABI,this.props.tx.contract);(function(t,e){return B.apply(this,arguments)})(e,this.props.tx.allowanceUnEdited).then((function(n){n?e.methods.approve(0,t.props.tx.allowanceUnEdited).send({from:t.props.account}).then((function(t){console.log("revoked: "+JSON.stringify(t))})).catch((function(t){console.log("failed: "+JSON.stringify(t))})):e.methods.approve(t.props.tx.approved,0).send({from:t.props.account}).then((function(t){console.log("revoked: "+JSON.stringify(t))})).catch((function(t){console.log(t),console.log("failed: "+JSON.stringify(t))}))}))}},{key:"getDappButton",value:function(){var t=this.dappURL();return""!==t?Object(a.jsx)("button",{className:"btn btn-primary",onClick:function(){window.open(t)},id:this.props.id,children:" Visit dApp"}):null}},{key:"render",value:function(){var t=this;return Object(a.jsx)("div",{children:Object(a.jsxs)("div",{className:"grid-container",children:[Object(a.jsx)("div",{className:"grid-items",children:Object(a.jsx)("a",{href:this.props.etherscanURL+this.props.tx.contract,children:this.props.tx.contractName})}),Object(a.jsx)("div",{className:"grid-items",children:Object(a.jsx)("a",{href:this.props.etherscanURL+this.props.tx.approved,children:this.props.tx.approvedName})}),Object(a.jsx)("div",{className:"grid-items",children:this.props.tx.allowance}),Object(a.jsxs)("div",{className:"grid-items",children:[Object(a.jsx)("button",{className:"btn btn-danger",name:"revoke",onClick:function(){t.setRevokeClick()},children:" Revoke"}),this.getDappButton()]})]})})}}]),n}(s.Component),F=function(t){Object(f.a)(n,t);var e=Object(y.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).state={txs:void 0,account:void 0},a.props=t,a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){var t=this;document.getElementById("loading").hidden=!1,this.init().then((function(e){t.setState(e),document.getElementById("loading").hidden=!0,document.getElementById("revokeAll").hidden=!1})).catch((function(t){document.getElementById("loading").innerText=t}))}},{key:"init",value:function(){var t=Object(j.a)(v.a.mark((function t(){var e,n,a,s,i,r,o;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=null,t.prev=1,t.prev=2,t.next=5,this.props.web3.eth.requestAccounts();case 5:n=t.sent,e=n[0],t.next=15;break;case 9:return t.prev=9,t.t0=t.catch(2),t.next=13,window.ethereum.enable();case 13:a=t.sent,e=a[0];case 15:return t.next=17,this.props.web3.eth.getChainId();case 17:return s=t.sent,this.setState({chainId:s}),i=M(s,e),t.next=22,A(i);case 22:r=t.sent,t.t1=v.a.keys(r);case 24:if((t.t2=t.t1()).done){t.next=34;break}return o=t.t2.value,t.next=28,R(r[o].contract);case 28:return r[o].contractName=t.sent,t.next=31,R(r[o].approved);case 31:r[o].approvedName=t.sent,t.next=24;break;case 34:return t.abrupt("return",{txs:r,account:e});case 37:t.prev=37,t.t3=t.catch(1),document.getElementById("loading").hidden=!1,document.getElementById("loading").innerText=t.t3;case 41:case"end":return t.stop()}}),t,this,[[1,37],[2,9]])})));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=this,e="";if(void 0!==this.state.txs&&void 0!==this.state.chainId){var n=function(t){switch(t){case 1:return"https://etherscan.io/address/";case 3:return"https://ropsten.etherscan.io/address/";case 4:return"https://rinkeby.etherscan.io/address/";case 42:return"https://kovan.etherscan.io/address/";case 56:return"https://bscscan.com/address/";default:return""}}(this.state.chainId);e=this.state.txs.map((function(e){return Object(a.jsx)(J,{etherscanURL:n,tx:e,web3:t.props.web3,id:e.contract,account:t.state.account})}))}return Object(a.jsx)("div",{children:e})}}]),n}(s.Component),D=new u.a(u.a.givenProvider);var P=function(){return Object(a.jsxs)("div",{children:[Object(a.jsx)(b,{}),Object(a.jsx)(F,{web3:D})]})};o.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(P,{})}),document.getElementById("root")),c()},88:function(t,e){t.exports={ERC20ABI:[{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{payable:!0,stateMutability:"payable",type:"fallback"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}],ERC721ABI:[{constant:!0,inputs:[],name:"name",outputs:[{name:"_name",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"getApproved",outputs:[{name:"_approved",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_tokenId",type:"uint256"}],name:"approve",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"implementsERC721",outputs:[{name:"_implementsERC721",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"_totalSupply",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_tokenId",type:"uint256"}],name:"transferFrom",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{name:"_tokenId",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"ownerOf",outputs:[{name:"_owner",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_tokenId",type:"uint256"}],name:"tokenMetadata",outputs:[{name:"_infoUrl",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"_balance",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_owner",type:"address"},{name:"_tokenId",type:"uint256"},{name:"_approvedAddress",type:"address"},{name:"_metadata",type:"string"}],name:"mint",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"_symbol",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"_to",type:"address"},{name:"_tokenId",type:"uint256"}],name:"transfer",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"numTokensTotal",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"getOwnerTokens",outputs:[{name:"_tokenIds",type:"uint256[]"}],payable:!1,stateMutability:"view",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"_to",type:"address"},{indexed:!0,name:"_tokenId",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"_from",type:"address"},{indexed:!0,name:"_to",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"_owner",type:"address"},{indexed:!0,name:"_approved",type:"address"},{indexed:!1,name:"_tokenId",type:"uint256"}],name:"Approval",type:"event"}]}},89:function(t,e){t.exports={compound:"https://app.compound.finance/#",aave:"https://aave.com/",uniswap:"https://uniswap.org/",nest:"https://nestdapp.io/",cofi:"https://cofix.io/"}},90:function(t,e,n){}},[[446,1,2]]]);
//# sourceMappingURL=main.b92c3f28.chunk.js.map